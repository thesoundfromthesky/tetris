import{z as p,b as s,B as L,E as u,H as A,C as c,u as m,r as f}from"./index-CfS70t6F.js";import{A as _,G as g}from"./glTFLoader-DQB8554u.js";import"./objectModelMapping-D4YYZYlG.js";const a="KHR_lights_punctual";class E{constructor(n){this.name=a,this._loader=n,this.enabled=this._loader.isExtensionUsed(a)}dispose(){this._loader=null,delete this._lights}onLoading(){const n=this._loader.gltf.extensions;if(n&&n[this.name]){const o=n[this.name];this._lights=o.lights,_.Assign(this._lights)}}loadNodeAsync(n,o,b){return g.LoadExtensionAsync(n,o,this.name,(l,y)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(n,o,r=>{let t;const e=_.Get(l,this._lights,y.light),h=e.name||r.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,e.type){case"directional":{const i=new u(h,s.Backward(),this._loader.babylonScene);i.position.setAll(0),t=i;break}case"point":{t=new L(h,s.Zero(),this._loader.babylonScene);break}case"spot":{const i=new p(h,s.Zero(),s.Backward(),0,1,this._loader.babylonScene);i.angle=(e.spot&&e.spot.outerConeAngle||Math.PI/4)*2,i.innerAngle=(e.spot&&e.spot.innerConeAngle||0)*2,t=i;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${l}: Invalid light type (${e.type})`)}t._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,e._babylonLight=t,t.falloffType=A.FALLOFF_GLTF,t.diffuse=e.color?c.FromArray(e.color):c.White(),t.intensity=e.intensity==null?1:e.intensity,t.range=e.range==null?Number.MAX_VALUE:e.range,t.parent=r,this._loader._babylonLights.push(t),g.AddPointerMetadata(t,l),b(r)})))}}m(a);f(a,!0,d=>new E(d));export{E as KHR_lights};
