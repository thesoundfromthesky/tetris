const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-CfS70t6F.js","./index-D-73uZs9.css","./glTFLoaderAnimation-Cl2Ba7Mi.js","./objectModelMapping-D4YYZYlG.js"])))=>i.map(i=>d[i]);
import{U as ee,e as P,K as M,W as V,L as E,A as te,X as D,Y as X,Z as se,$ as ne,R as re,r as oe,u as ie,a0 as S,a1 as ae,M as J,a2 as le,a3 as K,a4 as he,G as de,a5 as ce,a6 as ue,b as T,l as N,Q as F,a7 as fe,a8 as _e,a9 as pe,aa as me,s as q,c as m,ab as ye,I as $,C as U,T as v,ac as ge,ad as be,ae as Ae,o as H,af as ve}from"./index-CfS70t6F.js";import{a as G}from"./objectModelMapping-D4YYZYlG.js";class Ee{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise((t,e)=>{this._resolve=t,this._reject=e})}}class W{constructor(t){this.byteOffset=0,this.buffer=t}loadAsync(t){return this.buffer.readAsync(this.byteOffset,t).then(e=>{this._dataView=new DataView(e.buffer,e.byteOffset,e.byteLength),this._dataByteOffset=0})}readUint32(){const t=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,t}readUint8Array(t){const e=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,t);return this._dataByteOffset+=t,this.byteOffset+=t,e}readString(t){return ee(this.readUint8Array(t))}skipBytes(t){this._dataByteOffset+=t,this.byteOffset+=t}}function j(u,t,e,s){const n={externalResourceFunction:s};return e&&(n.uri=t==="file:"?e:t+e),ArrayBuffer.isView(u)?GLTFValidator.validateBytes(u,n):GLTFValidator.validateString(u,n)}function Ce(){const u=[];onmessage=t=>{const e=t.data;switch(e.id){case"init":{importScripts(e.url);break}case"validate":{j(e.data,e.rootUrl,e.fileName,s=>new Promise((n,r)=>{const o=u.length;u.push({resolve:n,reject:r}),postMessage({id:"getExternalResource",index:o,uri:s})})).then(s=>{postMessage({id:"validate.resolve",value:s})},s=>{postMessage({id:"validate.reject",reason:s})});break}case"getExternalResource.resolve":{u[e.index].resolve(e.value);break}case"getExternalResource.reject":{u[e.index].reject(e.reason);break}}}}class Z{static ValidateAsync(t,e,s,n){return typeof Worker=="function"?new Promise((r,o)=>{const i=`${j}(${Ce})()`,a=URL.createObjectURL(new Blob([i],{type:"application/javascript"})),l=new Worker(a),h=c=>{l.removeEventListener("error",h),l.removeEventListener("message",d),o(c)},d=c=>{const p=c.data;switch(p.id){case"getExternalResource":{n(p.uri).then(_=>{l.postMessage({id:"getExternalResource.resolve",index:p.index,value:_},[_.buffer])},_=>{l.postMessage({id:"getExternalResource.reject",index:p.index,reason:_})});break}case"validate.resolve":{l.removeEventListener("error",h),l.removeEventListener("message",d),r(p.value),l.terminate();break}case"validate.reject":l.removeEventListener("error",h),l.removeEventListener("message",d),o(p.reason),l.terminate()}};if(l.addEventListener("error",h),l.addEventListener("message",d),l.postMessage({id:"init",url:P.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(t)){const c=t.slice();l.postMessage({id:"validate",data:c,rootUrl:e,fileName:s},[c.buffer])}else l.postMessage({id:"validate",data:t,rootUrl:e,fileName:s})}):(this._LoadScriptPromise||(this._LoadScriptPromise=P.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then(()=>j(t,e,s,n)))}}Z.Configuration={url:`${P._DefaultCdnUrl}/gltf_validator.js`};function z(u,t,e){try{return Promise.resolve(new Uint8Array(u,t,e))}catch(s){return Promise.reject(s)}}function we(u,t,e){try{if(t<0||t>=u.byteLength)throw new RangeError("Offset is out of range.");if(t+e>u.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(u.buffer,u.byteOffset+t,e))}catch(s){return Promise.reject(s)}}var k;(function(u){u[u.AUTO=0]="AUTO",u[u.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"})(k||(k={}));var I;(function(u){u[u.NONE=0]="NONE",u[u.FIRST=1]="FIRST",u[u.ALL=2]="ALL"})(I||(I={}));var w;(function(u){u[u.LOADING=0]="LOADING",u[u.READY=1]="READY",u[u.COMPLETE=2]="COMPLETE"})(w||(w={}));class Oe{constructor(){this.coordinateSystemMode=k.AUTO,this.animationStartMode=I.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=t=>Promise.resolve(t),this.extensionOptions={}}copyFrom(t){t&&(this.onParsed=t.onParsed,this.coordinateSystemMode=t.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=t.animationStartMode??this.animationStartMode,this.loadNodeAnimations=t.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=t.loadSkins??this.loadSkins,this.loadMorphTargets=t.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=t.compileMaterials??this.compileMaterials,this.useClipPlane=t.useClipPlane??this.useClipPlane,this.compileShadowGenerators=t.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=t.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=t.useRangeRequests??this.useRangeRequests,this.createInstances=t.createInstances??this.createInstances,this.alwaysComputeBoundingBox=t.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=t.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=t.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=t.skipMaterials??this.skipMaterials,this.useSRGBBuffers=t.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=t.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=t.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=t.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=t.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=t.customRootNode,this.onMeshLoaded=t.onMeshLoaded,this.onSkinLoaded=t.onSkinLoaded,this.onTextureLoaded=t.onTextureLoaded,this.onMaterialLoaded=t.onMaterialLoaded,this.onCameraLoaded=t.onCameraLoaded,this.extensionOptions=t.extensionOptions??this.extensionOptions)}}class O extends Oe{constructor(t){super(),this.onParsedObservable=new M,this.onMeshLoadedObservable=new M,this.onSkinLoadedObservable=new M,this.onTextureLoadedObservable=new M,this.onMaterialLoadedObservable=new M,this.onCameraLoadedObservable=new M,this.onCompleteObservable=new M,this.onErrorObservable=new M,this.onDisposeObservable=new M,this.onExtensionLoadedObservable=new M,this.validate=!1,this.onValidatedObservable=new M,this._loader=null,this._state=null,this._requests=new Array,this.name=V.name,this.extensions=V.extensions,this.onLoaderStateChangedObservable=new M,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.copyFrom(t)}set onParsed(t){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),t&&(this._onParsedObserver=this.onParsedObservable.add(t))}set onMeshLoaded(t){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),t&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(t))}set onSkinLoaded(t){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),t&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add(e=>t(e.node,e.skinnedNode)))}set onTextureLoaded(t){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),t&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(t))}set onMaterialLoaded(t){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),t&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(t))}set onCameraLoaded(t){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),t&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(t))}set onComplete(t){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(t)}set onError(t){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(t)}set onDispose(t){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(t)}set onExtensionLoaded(t){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(t)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(t){this._loggingEnabled!==t&&(this._loggingEnabled=t,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(t){this._capturePerformanceCounters!==t&&(this._capturePerformanceCounters=t,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(t){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(t)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const t of this._requests)t.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=t=>Promise.resolve(t),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.onDisposeObservable.notifyObservers(void 0),this.onDisposeObservable.clear()}loadFile(t,e,s,n,r,o,i,a){if(ArrayBuffer.isView(e))return this._loadBinary(t,e,s,n,i,a),null;this._progressCallback=r;const l=e.name||P.GetFilename(e);if(o){if(this.useRangeRequests){this.validate&&E.Warn("glTF validation is not supported when range requests are enabled");const h={abort:()=>{},onCompleteObservable:new M},d={readAsync:(c,p)=>new Promise((_,b)=>{this._loadFile(t,e,A=>{_(new Uint8Array(A))},!0,A=>{b(A)},A=>{A.setRequestHeader("Range",`bytes=${c}-${c+p-1}`)})}),byteLength:0};return this._unpackBinaryAsync(new W(d)).then(c=>{h.onCompleteObservable.notifyObservers(h),n(c)},i?c=>i(void 0,c):void 0),h}return this._loadFile(t,e,h=>{this._validate(t,new Uint8Array(h,0,h.byteLength),s,l),this._unpackBinaryAsync(new W({readAsync:(d,c)=>z(h,d,c),byteLength:h.byteLength})).then(d=>{n(d)},i?d=>i(void 0,d):void 0)},!0,i)}else return this._loadFile(t,e,h=>{try{this._validate(t,h,s,l),n({json:this._parseJson(h)})}catch{i&&i()}},!1,i)}_loadBinary(t,e,s,n,r,o){this._validate(t,new Uint8Array(e.buffer,e.byteOffset,e.byteLength),s,o),this._unpackBinaryAsync(new W({readAsync:(i,a)=>we(e,i,a),byteLength:e.byteLength})).then(i=>{n(i)},r?i=>r(void 0,i):void 0)}importMeshAsync(t,e,s,n,r,o){return Promise.resolve().then(()=>(this.onParsedObservable.notifyObservers(s),this.onParsedObservable.clear(),this._log(`Loading ${o||""}`),this._loader=this._getLoader(s),this._loader.importMeshAsync(t,e,null,s,n,r,o)))}loadAsync(t,e,s,n,r){return Promise.resolve().then(()=>(this.onParsedObservable.notifyObservers(e),this.onParsedObservable.clear(),this._log(`Loading ${r||""}`),this._loader=this._getLoader(e),this._loader.loadAsync(t,e,s,n,r)))}loadAssetContainerAsync(t,e,s,n,r){return Promise.resolve().then(()=>{this.onParsedObservable.notifyObservers(e),this.onParsedObservable.clear(),this._log(`Loading ${r||""}`),this._loader=this._getLoader(e);const o=new te(t),i=[];this.onMaterialLoadedObservable.add(d=>{i.push(d)});const a=[];this.onTextureLoadedObservable.add(d=>{a.push(d)});const l=[];this.onCameraLoadedObservable.add(d=>{l.push(d)});const h=[];return this.onMeshLoadedObservable.add(d=>{d.morphTargetManager&&h.push(d.morphTargetManager)}),this._loader.importMeshAsync(null,t,o,e,s,n,r).then(d=>(Array.prototype.push.apply(o.geometries,d.geometries),Array.prototype.push.apply(o.meshes,d.meshes),Array.prototype.push.apply(o.particleSystems,d.particleSystems),Array.prototype.push.apply(o.skeletons,d.skeletons),Array.prototype.push.apply(o.animationGroups,d.animationGroups),Array.prototype.push.apply(o.materials,i),Array.prototype.push.apply(o.textures,a),Array.prototype.push.apply(o.lights,d.lights),Array.prototype.push.apply(o.transformNodes,d.transformNodes),Array.prototype.push.apply(o.cameras,l),Array.prototype.push.apply(o.morphTargetManagers,h),o))})}canDirectLoad(t){return V.canDirectLoad(t)}directLoad(t,e){if(e.startsWith("base64,"+D)||e.startsWith(";base64,"+D)||e.startsWith("application/octet-stream;base64,"+D)||e.startsWith("model/gltf-binary;base64,"+D)){const s=X(e);return this._validate(t,new Uint8Array(s,0,s.byteLength)),this._unpackBinaryAsync(new W({readAsync:(n,r)=>z(s,n,r),byteLength:s.byteLength}))}return this._validate(t,e),Promise.resolve({json:this._parseJson(e)})}createPlugin(t){return new O(t[V.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise((t,e)=>{this.onCompleteObservable.addOnce(()=>{t()}),this.onErrorObservable.addOnce(s=>{e(s)})})}_setState(t){this._state!==t&&(this._state=t,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(w[this._state]))}_loadFile(t,e,s,n,r,o){const i=t._loadFile(e,s,a=>{this._onProgress(a,i)},!0,n,r,o);return i.onCompleteObservable.add(()=>{i._lengthComputable=!0,i._total=i._loaded}),this._requests.push(i),i}_onProgress(t,e){if(!this._progressCallback)return;e._lengthComputable=t.lengthComputable,e._loaded=t.loaded,e._total=t.total;let s=!0,n=0,r=0;for(const o of this._requests){if(o._lengthComputable===void 0||o._loaded===void 0||o._total===void 0)return;s=s&&o._lengthComputable,n+=o._loaded,r+=o._total}this._progressCallback({lengthComputable:s,loaded:n,total:s?r:0})}_validate(t,e,s="",n=""){this.validate&&(this._startPerformanceCounter("Validate JSON"),Z.ValidateAsync(e,s,n,r=>this.preprocessUrlAsync(s+r).then(o=>t._loadFileAsync(o,void 0,!0,!0).then(i=>new Uint8Array(i,0,i.byteLength)))).then(r=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(r),this.onValidatedObservable.clear()},r=>{this._endPerformanceCounter("Validate JSON"),P.Warn(`Failed to validate: ${r.message}`),this.onValidatedObservable.clear()}))}_getLoader(t){const e=t.json.asset||{};this._log(`Asset version: ${e.version}`),e.minVersion&&this._log(`Asset minimum version: ${e.minVersion}`),e.generator&&this._log(`Asset generator: ${e.generator}`);const s=O._parseVersion(e.version);if(!s)throw new Error("Invalid version: "+e.version);if(e.minVersion!==void 0){const o=O._parseVersion(e.minVersion);if(!o)throw new Error("Invalid minimum version: "+e.minVersion);if(O._compareVersion(o,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+e.minVersion)}const r={1:O._CreateGLTF1Loader,2:O._CreateGLTF2Loader}[s.major];if(!r)throw new Error("Unsupported version: "+e.version);return r(this)}_parseJson(t){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${t.length}`);const e=JSON.parse(t);return this._endPerformanceCounter("Parse JSON"),e}_unpackBinaryAsync(t){return this._startPerformanceCounter("Unpack Binary"),t.loadAsync(20).then(()=>{const e={Magic:1179937895},s=t.readUint32();if(s!==e.Magic)throw new se("Unexpected magic: "+s,ne.GLTFLoaderUnexpectedMagicError);const n=t.readUint32();this.loggingEnabled&&this._log(`Binary version: ${n}`);const r=t.readUint32();!this.useRangeRequests&&r!==t.buffer.byteLength&&E.Warn(`Length in header does not match actual data length: ${r} != ${t.buffer.byteLength}`);let o;switch(n){case 1:{o=this._unpackBinaryV1Async(t,r);break}case 2:{o=this._unpackBinaryV2Async(t,r);break}default:throw new Error("Unsupported version: "+n)}return this._endPerformanceCounter("Unpack Binary"),o})}_unpackBinaryV1Async(t,e){const s={JSON:0},n=t.readUint32(),r=t.readUint32();if(r!==s.JSON)throw new Error(`Unexpected content format: ${r}`);const o=e-t.byteOffset,i={json:this._parseJson(t.readString(n)),bin:null};if(o!==0){const a=t.byteOffset;i.bin={readAsync:(l,h)=>t.buffer.readAsync(a+l,h),byteLength:o}}return Promise.resolve(i)}_unpackBinaryV2Async(t,e){const s={JSON:1313821514,BIN:5130562},n=t.readUint32();if(t.readUint32()!==s.JSON)throw new Error("First chunk format is not JSON");return t.byteOffset+n===e?t.loadAsync(n).then(()=>({json:this._parseJson(t.readString(n)),bin:null})):t.loadAsync(n+8).then(()=>{const o={json:this._parseJson(t.readString(n)),bin:null},i=()=>{const a=t.readUint32();switch(t.readUint32()){case s.JSON:throw new Error("Unexpected JSON chunk");case s.BIN:{const h=t.byteOffset;o.bin={readAsync:(d,c)=>t.buffer.readAsync(h+d,c),byteLength:a},t.skipBytes(a);break}default:{t.skipBytes(a);break}}return t.byteOffset!==e?t.loadAsync(8).then(i):Promise.resolve(o)};return i()})}static _parseVersion(t){if(t==="1.0"||t==="1.0.1")return{major:1,minor:0};const e=(t+"").match(/^(\d+)\.(\d+)/);return e?{major:parseInt(e[1]),minor:parseInt(e[2])}:null}static _compareVersion(t,e){return t.major>e.major?1:t.major<e.major?-1:t.minor>e.minor?1:t.minor<e.minor?-1:0}_logOpen(t){this._log(t),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(t){const e=O._logSpaces.substring(0,this._logIndentLevel*2);E.Log(`${e}${t}`)}_logDisabled(t){}_startPerformanceCounterEnabled(t){P.StartPerformanceCounter(t)}_startPerformanceCounterDisabled(t){}_endPerformanceCounterEnabled(t){P.EndPerformanceCounter(t)}_endPerformanceCounterDisabled(t){}}O.IncrementalLoading=!0;O.HomogeneousCoordinates=!1;O._logSpaces="                                ";re(new O);class f{static Get(t,e,s){if(!e||s==null||!e[s])throw new Error(`${t}: Failed to find index (${s})`);return e[s]}static TryGet(t,e){return!t||e==null||!t[e]?null:t[e]}static Assign(t){if(t)for(let e=0;e<t.length;e++)t[e].index=e}}function Q(u){if(u.min&&u.max){const t=u.min,e=u.max,s=H.Vector3[0].copyFromFloats(t[0],t[1],t[2]),n=H.Vector3[1].copyFromFloats(e[0],e[1],e[2]);if(u.normalized&&u.componentType!==5126){let r=1;switch(u.componentType){case 5120:r=127;break;case 5121:r=255;break;case 5122:r=32767;break;case 5123:r=65535;break}const o=1/r;s.scaleInPlace(o),n.scaleInPlace(o)}return new ve(s,n)}return null}class y{static RegisterExtension(t,e){oe(t,!1,e)}static UnregisterExtension(t){return ie(t)}get gltf(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(t){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=t}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach(t=>t.dispose&&t.dispose()),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}importMeshAsync(t,e,s,n,r,o,i=""){return Promise.resolve().then(()=>{this._babylonScene=e,this._assetContainer=s,this._loadData(n);let a=null;if(t){const l={};if(this._gltf.nodes)for(const d of this._gltf.nodes)d.name&&(l[d.name]=d.index);a=(t instanceof Array?t:[t]).map(d=>{const c=l[d];if(c===void 0)throw new Error(`Failed to find node '${d}'`);return c})}return this._loadAsync(r,i,a,()=>({meshes:this._getMeshes(),particleSystems:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]}))})}loadAsync(t,e,s,n,r=""){return Promise.resolve().then(()=>(this._babylonScene=t,this._loadData(e),this._loadAsync(s,r,null,()=>{})))}_loadAsync(t,e,s,n){return Promise.resolve().then(async()=>{this._rootUrl=t,this._uniqueRootUrl=!t.startsWith("file:")&&e?t:`${t}${Date.now()}/`,this._fileName=e,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const r=`${w[w.LOADING]} => ${w[w.READY]}`,o=`${w[w.LOADING]} => ${w[w.COMPLETE]}`;this._parent._startPerformanceCounter(r),this._parent._startPerformanceCounter(o),this._parent._setState(w.LOADING),this._extensionsOnLoading();const i=new Array,a=this._babylonScene.blockMaterialDirtyMechanism;if(this._babylonScene.blockMaterialDirtyMechanism=!0,!this.parent.loadOnlyMaterials){if(s)i.push(this.loadSceneAsync("/nodes",{nodes:s,index:-1}));else if(this._gltf.scene!=null||this._gltf.scenes&&this._gltf.scenes[0]){const h=f.Get("/scene",this._gltf.scenes,this._gltf.scene||0);i.push(this.loadSceneAsync(`/scenes/${h.index}`,h))}}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let h=0;h<this._gltf.materials.length;++h){const d=this._gltf.materials[h],c="/materials/"+h,p=S.TriangleFillMode;i.push(this._loadMaterialAsync(c,d,null,p,()=>{}))}return this._allMaterialsDirtyRequired?this._babylonScene.blockMaterialDirtyMechanism=a:this._babylonScene._forceBlockMaterialDirtyMechanism(a),this._parent.compileMaterials&&i.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&i.push(this._compileShadowGeneratorsAsync()),Promise.all(i).then(()=>{this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.setEnabled(!0);for(const h of this._babylonScene.materials){const d=h;d.maxSimultaneousLights!==void 0&&(d.maxSimultaneousLights=Math.max(d.maxSimultaneousLights,this._babylonScene.lights.length))}return this._extensionsOnReady(),this._parent._setState(w.READY),this._skipStartAnimationStep||this._startAnimations(),n()}).then(h=>(this._parent._endPerformanceCounter(r),P.SetImmediate(()=>{this._disposed||Promise.all(this._completePromises).then(()=>{this._parent._endPerformanceCounter(o),this._parent._setState(w.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()},d=>{this._parent.onErrorObservable.notifyObservers(d),this._parent.onErrorObservable.clear(),this.dispose()})}),h))}).catch(r=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(r),this._parent.onErrorObservable.clear(),this.dispose()),r})}_loadData(t){if(this._gltf=t.json,this._setupData(),t.bin){const e=this._gltf.buffers;if(e&&e[0]&&!e[0].uri){const s=e[0];(s.byteLength<t.bin.byteLength-3||s.byteLength>t.bin.byteLength)&&E.Warn(`Binary buffer length (${s.byteLength}) from JSON does not match chunk length (${t.bin.byteLength})`),this._bin=t.bin}else E.Warn("Unexpected BIN chunk")}}_setupData(){if(f.Assign(this._gltf.accessors),f.Assign(this._gltf.animations),f.Assign(this._gltf.buffers),f.Assign(this._gltf.bufferViews),f.Assign(this._gltf.cameras),f.Assign(this._gltf.images),f.Assign(this._gltf.materials),f.Assign(this._gltf.meshes),f.Assign(this._gltf.nodes),f.Assign(this._gltf.samplers),f.Assign(this._gltf.scenes),f.Assign(this._gltf.skins),f.Assign(this._gltf.textures),this._gltf.nodes){const t={};for(const s of this._gltf.nodes)if(s.children)for(const n of s.children)t[n]=s.index;const e=this._createRootNode();for(const s of this._gltf.nodes){const n=t[s.index];s.parent=n===void 0?e:this._gltf.nodes[n]}}}async _loadExtensionsAsync(){var e;const t=[];if(ae.forEach((s,n)=>{var r;((r=this.parent.extensionOptions[n])==null?void 0:r.enabled)===!1?s.isGLTFExtension&&this.isExtensionUsed(n)&&E.Warn(`Extension ${n} is used but has been explicitly disabled.`):(!s.isGLTFExtension||this.isExtensionUsed(n))&&t.push((async()=>{const o=await s.factory(this);return o.name!==n&&E.Warn(`The name of the glTF loader extension instance does not match the registered name: ${o.name} !== ${n}`),this._parent.onExtensionLoadedObservable.notifyObservers(o),o})())}),this._extensions.push(...await Promise.all(t)),this._extensions.sort((s,n)=>(s.order||Number.MAX_VALUE)-(n.order||Number.MAX_VALUE)),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired){for(const s of this._gltf.extensionsRequired)if(!this._extensions.some(r=>r.name===s&&r.enabled))throw((e=this.parent.extensionOptions[s])==null?void 0:e.enabled)===!1?new Error(`Required extension ${s} is disabled`):new Error(`Required extension ${s} is not available`)}}_createRootNode(){if(this._parent.customRootNode!==void 0)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:this._rootBabylonMesh===null?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const t=new J("__root__",this._babylonScene);this._rootBabylonMesh=t,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.setEnabled(!1);const e={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case k.AUTO:{this._babylonScene.useRightHandedSystem||(e.rotation=[0,1,0,0],e.scale=[1,1,-1],y._LoadTransform(e,this._rootBabylonMesh));break}case k.FORCE_RIGHT_HANDED:{this._babylonScene.useRightHandedSystem=!0;break}default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(t),e}loadSceneAsync(t,e){const s=this._extensionsLoadSceneAsync(t,e);if(s)return s;const n=new Array;if(this.logOpen(`${t} ${e.name||""}`),e.nodes)for(const r of e.nodes){const o=f.Get(`${t}/nodes/${r}`,this._gltf.nodes,r);n.push(this.loadNodeAsync(`/nodes/${o.index}`,o,i=>{i.parent=this._rootBabylonMesh}))}for(const r of this._postSceneLoadActions)r();return n.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(n).then(()=>{})}_forEachPrimitive(t,e){if(t._primitiveBabylonMeshes)for(const s of t._primitiveBabylonMeshes)e(s)}_getGeometries(){const t=[],e=this._gltf.nodes;if(e)for(const s of e)this._forEachPrimitive(s,n=>{const r=n.geometry;r&&t.indexOf(r)===-1&&t.push(r)});return t}_getMeshes(){const t=[];this._rootBabylonMesh instanceof le&&t.push(this._rootBabylonMesh);const e=this._gltf.nodes;if(e)for(const s of e)this._forEachPrimitive(s,n=>{t.push(n)});return t}_getTransformNodes(){const t=[],e=this._gltf.nodes;if(e)for(const s of e)s._babylonTransformNode&&s._babylonTransformNode.getClassName()==="TransformNode"&&t.push(s._babylonTransformNode),s._babylonTransformNodeForSkin&&t.push(s._babylonTransformNodeForSkin);return t}_getSkeletons(){const t=[],e=this._gltf.skins;if(e)for(const s of e)s._data&&t.push(s._data.babylonSkeleton);return t}_getAnimationGroups(){const t=[],e=this._gltf.animations;if(e)for(const s of e)s._babylonAnimationGroup&&t.push(s._babylonAnimationGroup);return t}_startAnimations(){switch(this._parent.animationStartMode){case I.NONE:break;case I.FIRST:{const t=this._getAnimationGroups();t.length!==0&&t[0].start(!0);break}case I.ALL:{const t=this._getAnimationGroups();for(const e of t)e.start(!0);break}default:{E.Error(`Invalid animation start mode (${this._parent.animationStartMode})`);return}}}loadNodeAsync(t,e,s=()=>{}){const n=this._extensionsLoadNodeAsync(t,e,s);if(n)return n;if(e._babylonTransformNode)throw new Error(`${t}: Invalid recursive node hierarchy`);const r=new Array;this.logOpen(`${t} ${e.name||""}`);const o=l=>{if(y.AddPointerMetadata(l,t),y._LoadTransform(e,l),e.camera!=null){const h=f.Get(`${t}/camera`,this._gltf.cameras,e.camera);r.push(this.loadCameraAsync(`/cameras/${h.index}`,h,d=>{d.parent=l}))}if(e.children)for(const h of e.children){const d=f.Get(`${t}/children/${h}`,this._gltf.nodes,h);r.push(this.loadNodeAsync(`/nodes/${d.index}`,d,c=>{c.parent=l}))}s(l)},i=e.mesh!=null,a=this._parent.loadSkins&&e.skin!=null;if(!i||a){const l=e.name||`node${e.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const h=new K(l,this._babylonScene);h._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,e.mesh==null?e._babylonTransformNode=h:e._babylonTransformNodeForSkin=h,o(h)}if(i)if(a){const l=f.Get(`${t}/mesh`,this._gltf.meshes,e.mesh);r.push(this._loadMeshAsync(`/meshes/${l.index}`,e,l,h=>{const d=e._babylonTransformNodeForSkin;h.metadata=he(d.metadata,h.metadata||{});const c=f.Get(`${t}/skin`,this._gltf.skins,e.skin);r.push(this._loadSkinAsync(`/skins/${c.index}`,e,c,p=>{this._forEachPrimitive(e,_=>{_.skeleton=p}),this._postSceneLoadActions.push(()=>{if(c.skeleton!=null){const _=f.Get(`/skins/${c.index}/skeleton`,this._gltf.nodes,c.skeleton).parent;e.index===_.index?h.parent=d.parent:h.parent=_._babylonTransformNode}else h.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:d,skinnedNode:h})})}))}))}else{const l=f.Get(`${t}/mesh`,this._gltf.meshes,e.mesh);r.push(this._loadMeshAsync(`/meshes/${l.index}`,e,l,o))}return this.logClose(),Promise.all(r).then(()=>(this._forEachPrimitive(e,l=>{const h=l;!h.isAnInstance&&h.geometry&&h.geometry.useBoundingInfoFromGeometry?l._updateBoundingInfo():l.refreshBoundingInfo(!0,!0)}),e._babylonTransformNode))}_loadMeshAsync(t,e,s,n){const r=s.primitives;if(!r||!r.length)throw new Error(`${t}: Primitives are missing`);r[0].index==null&&f.Assign(r);const o=new Array;this.logOpen(`${t} ${s.name||""}`);const i=e.name||`node${e.index}`;if(r.length===1){const a=s.primitives[0];o.push(this._loadMeshPrimitiveAsync(`${t}/primitives/${a.index}`,i,e,s,a,l=>{e._babylonTransformNode=l,e._primitiveBabylonMeshes=[l]}))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,e._babylonTransformNode=new K(i,this._babylonScene),e._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,e._primitiveBabylonMeshes=[];for(const a of r)o.push(this._loadMeshPrimitiveAsync(`${t}/primitives/${a.index}`,`${i}_primitive${a.index}`,e,s,a,l=>{l.parent=e._babylonTransformNode,e._primitiveBabylonMeshes.push(l)}))}return n(e._babylonTransformNode),this.logClose(),Promise.all(o).then(()=>e._babylonTransformNode)}_loadMeshPrimitiveAsync(t,e,s,n,r,o){const i=this._extensionsLoadMeshPrimitiveAsync(t,e,s,n,r,o);if(i)return i;this.logOpen(`${t}`);const a=this._disableInstancedMesh===0&&this._parent.createInstances&&s.skin==null&&!n.primitives[0].targets;let l,h;if(a&&r._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,l=r._instanceData.babylonSourceMesh.createInstance(e),l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h=r._instanceData.promise;else{const d=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const c=new J(e,this._babylonScene);c._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,c.sideOrientation=this._babylonScene.useRightHandedSystem?S.CounterClockWiseSideOrientation:S.ClockWiseSideOrientation,this._createMorphTargets(t,s,n,r,c),d.push(this._loadVertexDataAsync(t,r,c).then(_=>this._loadMorphTargetsAsync(t,r,c,_).then(()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,_.applyToMesh(c),_._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})));const p=y._GetDrawMode(t,r.mode);if(r.material==null){let _=this._defaultBabylonMaterialData[p];_||(_=this._createDefaultMaterial("__GLTFLoader._default",p),this._parent.onMaterialLoadedObservable.notifyObservers(_),this._defaultBabylonMaterialData[p]=_),c.material=_}else if(!this.parent.skipMaterials){const _=f.Get(`${t}/material`,this._gltf.materials,r.material);d.push(this._loadMaterialAsync(`/materials/${_.index}`,_,c,p,b=>{c.material=b}))}h=Promise.all(d),a&&(r._instanceData={babylonSourceMesh:c,promise:h}),l=c}return y.AddPointerMetadata(l,t),this._parent.onMeshLoadedObservable.notifyObservers(l),o(l),this.logClose(),h.then(()=>l)}_loadVertexDataAsync(t,e,s){const n=this._extensionsLoadVertexDataAsync(t,e,s);if(n)return n;const r=e.attributes;if(!r)throw new Error(`${t}: Attributes are missing`);const o=new Array,i=new de(s.name,this._babylonScene);if(e.indices==null)s.isUnIndexed=!0;else{const l=f.Get(`${t}/indices`,this._gltf.accessors,e.indices);o.push(this._loadIndicesAccessorAsync(`/accessors/${l.index}`,l).then(h=>{i.setIndices(h)}))}const a=(l,h,d)=>{if(r[l]==null)return;s._delayInfo=s._delayInfo||[],s._delayInfo.indexOf(h)===-1&&s._delayInfo.push(h);const c=f.Get(`${t}/attributes/${l}`,this._gltf.accessors,r[l]);o.push(this._loadVertexAccessorAsync(`/accessors/${c.index}`,c,h).then(p=>{if(p.getKind()===m.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!s.skeleton){const _=Q(c);_&&(i._boundingInfo=_,i.useBoundingInfoFromGeometry=!0)}i.setVerticesBuffer(p,c.count)})),h==m.MatricesIndicesExtraKind&&(s.numBoneInfluencers=8),d&&d(c)};return a("POSITION",m.PositionKind),a("NORMAL",m.NormalKind),a("TANGENT",m.TangentKind),a("TEXCOORD_0",m.UVKind),a("TEXCOORD_1",m.UV2Kind),a("TEXCOORD_2",m.UV3Kind),a("TEXCOORD_3",m.UV4Kind),a("TEXCOORD_4",m.UV5Kind),a("TEXCOORD_5",m.UV6Kind),a("JOINTS_0",m.MatricesIndicesKind),a("WEIGHTS_0",m.MatricesWeightsKind),a("JOINTS_1",m.MatricesIndicesExtraKind),a("WEIGHTS_1",m.MatricesWeightsExtraKind),a("COLOR_0",m.ColorKind,l=>{l.type==="VEC4"&&(s.hasVertexAlpha=!0)}),Promise.all(o).then(()=>i)}_createMorphTargets(t,e,s,n,r){if(!n.targets||!this._parent.loadMorphTargets)return;if(e._numMorphTargets==null)e._numMorphTargets=n.targets.length;else if(n.targets.length!==e._numMorphTargets)throw new Error(`${t}: Primitives do not have the same number of targets`);const o=s.extras?s.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,r.morphTargetManager=new ce(this._babylonScene),r.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,r.morphTargetManager.areUpdatesFrozen=!0;for(let i=0;i<n.targets.length;i++){const a=e.weights?e.weights[i]:s.weights?s.weights[i]:0,l=o?o[i]:`morphTarget${i}`;r.morphTargetManager.addTarget(new ue(l,a,r.getScene()))}}_loadMorphTargetsAsync(t,e,s,n){if(!e.targets||!this._parent.loadMorphTargets)return Promise.resolve();const r=new Array,o=s.morphTargetManager;for(let i=0;i<o.numTargets;i++){const a=o.getTarget(i);r.push(this._loadMorphTargetVertexDataAsync(`${t}/targets/${i}`,n,e.targets[i],a))}return Promise.all(r).then(()=>{o.areUpdatesFrozen=!1})}_loadMorphTargetVertexDataAsync(t,e,s,n){const r=new Array,o=(i,a,l)=>{if(s[i]==null)return;const h=e.getVertexBuffer(a);if(!h)return;const d=f.Get(`${t}/${i}`,this._gltf.accessors,s[i]);r.push(this._loadFloatAccessorAsync(`/accessors/${d.index}`,d).then(c=>{l(h,c)}))};return o("POSITION",m.PositionKind,(i,a)=>{const l=new Float32Array(a.length);i.forEach(a.length,(h,d)=>{l[d]=a[d]+h}),n.setPositions(l)}),o("NORMAL",m.NormalKind,(i,a)=>{const l=new Float32Array(a.length);i.forEach(l.length,(h,d)=>{l[d]=a[d]+h}),n.setNormals(l)}),o("TANGENT",m.TangentKind,(i,a)=>{const l=new Float32Array(a.length/3*4);let h=0;i.forEach(a.length/3*4,(d,c)=>{(c+1)%4!==0&&(l[h]=a[h]+d,h++)}),n.setTangents(l)}),o("TEXCOORD_0",m.UVKind,(i,a)=>{const l=new Float32Array(a.length);i.forEach(a.length,(h,d)=>{l[d]=a[d]+h}),n.setUVs(l)}),o("TEXCOORD_1",m.UV2Kind,(i,a)=>{const l=new Float32Array(a.length);i.forEach(a.length,(h,d)=>{l[d]=a[d]+h}),n.setUV2s(l)}),o("COLOR_0",m.ColorKind,(i,a)=>{let l=null;const h=i.getSize();if(h===3){l=new Float32Array(a.length/3*4),i.forEach(a.length,(d,c)=>{const p=Math.floor(c/3),_=c%3;l[4*p+_]=a[3*p+_]+d});for(let d=0;d<a.length/3;++d)l[4*d+3]=1}else if(h===4)l=new Float32Array(a.length),i.forEach(a.length,(d,c)=>{l[c]=a[c]+d});else throw new Error(`${t}: Invalid number of components (${h}) for COLOR_0 attribute`);n.setColors(l)}),Promise.all(r).then(()=>{})}static _LoadTransform(t,e){if(t.skin!=null)return;let s=T.Zero(),n=F.Identity(),r=T.One();t.matrix?N.FromArray(t.matrix).decompose(r,n,s):(t.translation&&(s=T.FromArray(t.translation)),t.rotation&&(n=F.FromArray(t.rotation)),t.scale&&(r=T.FromArray(t.scale))),e.position=s,e.rotationQuaternion=n,e.scaling=r}_loadSkinAsync(t,e,s,n){if(!this._parent.loadSkins)return Promise.resolve();const r=this._extensionsLoadSkinAsync(t,e,s);if(r)return r;if(s._data)return n(s._data.babylonSkeleton),s._data.promise;const o=`skeleton${s.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const i=new fe(s.name||o,o,this._babylonScene);i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(t,s,i);const a=this._loadSkinInverseBindMatricesDataAsync(t,s).then(l=>{this._updateBoneMatrices(i,l)});return s._data={babylonSkeleton:i,promise:a},n(i),a}_loadBones(t,e,s){if(e.skeleton==null||this._parent.alwaysComputeSkeletonRootNode){const r=this._findSkeletonRootNode(`${t}/joints`,e.joints);if(r)if(e.skeleton===void 0)e.skeleton=r.index;else{const o=(a,l)=>{for(;l.parent;l=l.parent)if(l.parent===a)return!0;return!1},i=f.Get(`${t}/skeleton`,this._gltf.nodes,e.skeleton);i!==r&&!o(i,r)&&(E.Warn(`${t}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),e.skeleton=r.index)}else E.Warn(`${t}: Failed to find common root`)}const n={};for(const r of e.joints){const o=f.Get(`${t}/joints/${r}`,this._gltf.nodes,r);this._loadBone(o,e,s,n)}}_findSkeletonRootNode(t,e){if(e.length===0)return null;const s={};for(const r of e){const o=[];let i=f.Get(`${t}/${r}`,this._gltf.nodes,r);for(;i.index!==-1;)o.unshift(i),i=i.parent;s[r]=o}let n=null;for(let r=0;;++r){let o=s[e[0]];if(r>=o.length)return n;const i=o[r];for(let a=1;a<e.length;++a)if(o=s[e[a]],r>=o.length||i!==o[r])return n;n=i}}_loadBone(t,e,s,n){t._isJoint=!0;let r=n[t.index];if(r)return r;let o=null;t.index!==e.skeleton&&(t.parent&&t.parent.index!==-1?o=this._loadBone(t.parent,e,s,n):e.skeleton!==void 0&&E.Warn(`/skins/${e.index}/skeleton: Skeleton node is not a common root`));const i=e.joints.indexOf(t.index);return r=new _e(t.name||`joint${t.index}`,s,o,this._getNodeMatrix(t),null,null,i),n[t.index]=r,this._postSceneLoadActions.push(()=>{r.linkTransformNode(t._babylonTransformNode)}),r}_loadSkinInverseBindMatricesDataAsync(t,e){if(e.inverseBindMatrices==null)return Promise.resolve(null);const s=f.Get(`${t}/inverseBindMatrices`,this._gltf.accessors,e.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${s.index}`,s)}_updateBoneMatrices(t,e){for(const s of t.bones){const n=N.Identity(),r=s._index;e&&r!==-1&&(N.FromArrayToRef(e,r*16,n),n.invertToRef(n));const o=s.getParent();o&&n.multiplyToRef(o.getAbsoluteInverseBindMatrix(),n),s.updateMatrix(n,!1,!1),s._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(t){return t.matrix?N.FromArray(t.matrix):N.Compose(t.scale?T.FromArray(t.scale):T.One(),t.rotation?F.FromArray(t.rotation):F.Identity(),t.translation?T.FromArray(t.translation):T.Zero())}loadCameraAsync(t,e,s=()=>{}){const n=this._extensionsLoadCameraAsync(t,e,s);if(n)return n;const r=new Array;this.logOpen(`${t} ${e.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const o=new pe(e.name||`camera${e.index}`,T.Zero(),this._babylonScene,!1);switch(o._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,o.ignoreParentScaling=!0,e._babylonCamera=o,o.rotation.set(0,Math.PI,0),e.type){case"perspective":{const i=e.perspective;if(!i)throw new Error(`${t}: Camera perspective properties are missing`);o.fov=i.yfov,o.minZ=i.znear,o.maxZ=i.zfar||0;break}case"orthographic":{if(!e.orthographic)throw new Error(`${t}: Camera orthographic properties are missing`);o.mode=me.ORTHOGRAPHIC_CAMERA,o.orthoLeft=-e.orthographic.xmag,o.orthoRight=e.orthographic.xmag,o.orthoBottom=-e.orthographic.ymag,o.orthoTop=e.orthographic.ymag,o.minZ=e.orthographic.znear,o.maxZ=e.orthographic.zfar;break}default:throw new Error(`${t}: Invalid camera type (${e.type})`)}return y.AddPointerMetadata(o,t),this._parent.onCameraLoadedObservable.notifyObservers(o),s(o),this.logClose(),Promise.all(r).then(()=>o)}_loadAnimationsAsync(){const t=this._gltf.animations;if(!t)return Promise.resolve();const e=new Array;for(let s=0;s<t.length;s++){const n=t[s];e.push(this.loadAnimationAsync(`/animations/${n.index}`,n).then(r=>{r.targetedAnimations.length===0&&r.dispose()}))}return Promise.all(e).then(()=>{})}loadAnimationAsync(t,e){const s=this._extensionsLoadAnimationAsync(t,e);return s||q(async()=>{const{AnimationGroup:n}=await import("./index-CfS70t6F.js").then(r=>r.aU);return{AnimationGroup:n}},__vite__mapDeps([0,1]),import.meta.url).then(({AnimationGroup:n})=>{this._babylonScene._blockEntityCollection=!!this._assetContainer;const r=new n(e.name||`animation${e.index}`,this._babylonScene);r._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,e._babylonAnimationGroup=r;const o=new Array;f.Assign(e.channels),f.Assign(e.samplers);for(const i of e.channels)o.push(this._loadAnimationChannelAsync(`${t}/channels/${i.index}`,t,e,i,(a,l)=>{a.animations=a.animations||[],a.animations.push(l),r.addTargetedAnimation(l,a)}));return Promise.all(o).then(()=>(r.normalize(0),r))})}async _loadAnimationChannelAsync(t,e,s,n,r){var c,p,_,b;const o=this._extensionsLoadAnimationChannelAsync(t,e,s,n,r);if(o)return o;if(n.target.node==null)return Promise.resolve();const i=f.Get(`${t}/target/node`,this._gltf.nodes,n.target.node),a=n.target.path,l=a==="weights";if(l&&!i._numMorphTargets||!l&&!i._babylonTransformNode||!this._parent.loadNodeAnimations&&!l&&!i._isJoint)return Promise.resolve();await q(()=>import("./glTFLoaderAnimation-Cl2Ba7Mi.js"),__vite__mapDeps([2,0,1,3]),import.meta.url);let h;switch(a){case"translation":{h=(c=G("/nodes/{}/translation"))==null?void 0:c.interpolation;break}case"rotation":{h=(p=G("/nodes/{}/rotation"))==null?void 0:p.interpolation;break}case"scale":{h=(_=G("/nodes/{}/scale"))==null?void 0:_.interpolation;break}case"weights":{h=(b=G("/nodes/{}/weights"))==null?void 0:b.interpolation;break}default:throw new Error(`${t}/target/path: Invalid value (${n.target.path})`)}if(!h)throw new Error(`${t}/target/path: Could not find interpolation properties for target path (${n.target.path})`);const d={object:i,info:h};return this._loadAnimationChannelFromTargetInfoAsync(t,e,s,n,d,r)}_loadAnimationChannelFromTargetInfoAsync(t,e,s,n,r,o){const i=this.parent.targetFps,a=1/i,l=f.Get(`${t}/sampler`,s.samplers,n.sampler);return this._loadAnimationSamplerAsync(`${e}/samplers/${n.sampler}`,l).then(h=>{let d=0;const c=r.object,p=r.info;for(const _ of p){const b=_.getStride(c),A=h.input,L=h.output,x=new Array(A.length);let C=0;switch(h.interpolation){case"STEP":{for(let g=0;g<A.length;g++){const B=_.getValue(c,L,C,1);C+=b,x[g]={frame:A[g]*i,value:B,interpolation:1}}break}case"CUBICSPLINE":{for(let g=0;g<A.length;g++){const B=_.getValue(c,L,C,a);C+=b;const R=_.getValue(c,L,C,1);C+=b;const Y=_.getValue(c,L,C,a);C+=b,x[g]={frame:A[g]*i,inTangent:B,value:R,outTangent:Y}}break}case"LINEAR":{for(let g=0;g<A.length;g++){const B=_.getValue(c,L,C,1);C+=b,x[g]={frame:A[g]*i,value:B}}break}}if(C>0){const g=`${s.name||`animation${s.index}`}_channel${n.index}_${d}`,B=_.buildAnimations(c,g,i,x);for(const R of B)d++,o(R.babylonAnimatable,R.babylonAnimation)}}})}_loadAnimationSamplerAsync(t,e){if(e._data)return e._data;const s=e.interpolation||"LINEAR";switch(s){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${t}/interpolation: Invalid value (${e.interpolation})`)}const n=f.Get(`${t}/input`,this._gltf.accessors,e.input),r=f.Get(`${t}/output`,this._gltf.accessors,e.output);return e._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${n.index}`,n),this._loadFloatAccessorAsync(`/accessors/${r.index}`,r)]).then(([o,i])=>({input:o,interpolation:s,output:i})),e._data}loadBufferAsync(t,e,s,n){const r=this._extensionsLoadBufferAsync(t,e,s,n);if(r)return r;if(!e._data)if(e.uri)e._data=this.loadUriAsync(`${t}/uri`,e,e.uri);else{if(!this._bin)throw new Error(`${t}: Uri is missing or the binary glTF is missing its binary chunk`);e._data=this._bin.readAsync(0,e.byteLength)}return e._data.then(o=>{try{return new Uint8Array(o.buffer,o.byteOffset+s,n)}catch(i){throw new Error(`${t}: ${i.message}`)}})}loadBufferViewAsync(t,e){const s=this._extensionsLoadBufferViewAsync(t,e);if(s)return s;if(e._data)return e._data;const n=f.Get(`${t}/buffer`,this._gltf.buffers,e.buffer);return e._data=this.loadBufferAsync(`/buffers/${n.index}`,n,e.byteOffset||0,e.byteLength),e._data}_loadAccessorAsync(t,e,s){if(e._data)return e._data;const n=y._GetNumComponents(t,e.type),r=n*m.GetTypeByteLength(e.componentType),o=n*e.count;if(e.bufferView==null)e._data=Promise.resolve(new s(o));else{const i=f.Get(`${t}/bufferView`,this._gltf.bufferViews,e.bufferView);e._data=this.loadBufferViewAsync(`/bufferViews/${i.index}`,i).then(a=>{if(e.componentType===5126&&!e.normalized&&(!i.byteStride||i.byteStride===r))return y._GetTypedArray(t,e.componentType,a,e.byteOffset,o);{const l=new s(o);return m.ForEach(a,e.byteOffset||0,i.byteStride||r,n,e.componentType,l.length,e.normalized||!1,(h,d)=>{l[d]=h}),l}})}if(e.sparse){const i=e.sparse;e._data=e._data.then(a=>{const l=a,h=f.Get(`${t}/sparse/indices/bufferView`,this._gltf.bufferViews,i.indices.bufferView),d=f.Get(`${t}/sparse/values/bufferView`,this._gltf.bufferViews,i.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${h.index}`,h),this.loadBufferViewAsync(`/bufferViews/${d.index}`,d)]).then(([c,p])=>{const _=y._GetTypedArray(`${t}/sparse/indices`,i.indices.componentType,c,i.indices.byteOffset,i.count),b=n*i.count;let A;if(e.componentType===5126&&!e.normalized)A=y._GetTypedArray(`${t}/sparse/values`,e.componentType,p,i.values.byteOffset,b);else{const x=y._GetTypedArray(`${t}/sparse/values`,e.componentType,p,i.values.byteOffset,b);A=new s(b),m.ForEach(x,0,r,n,e.componentType,A.length,e.normalized||!1,(C,g)=>{A[g]=C})}let L=0;for(let x=0;x<_.length;x++){let C=_[x]*n;for(let g=0;g<n;g++)l[C++]=A[L++]}return l})})}return e._data}_loadFloatAccessorAsync(t,e){return this._loadAccessorAsync(t,e,Float32Array)}_loadIndicesAccessorAsync(t,e){if(e.type!=="SCALAR")throw new Error(`${t}/type: Invalid value ${e.type}`);if(e.componentType!==5121&&e.componentType!==5123&&e.componentType!==5125)throw new Error(`${t}/componentType: Invalid value ${e.componentType}`);if(e._data)return e._data;if(e.sparse){const s=y._GetTypedArrayConstructor(`${t}/componentType`,e.componentType);e._data=this._loadAccessorAsync(t,e,s)}else{const s=f.Get(`${t}/bufferView`,this._gltf.bufferViews,e.bufferView);e._data=this.loadBufferViewAsync(`/bufferViews/${s.index}`,s).then(n=>y._GetTypedArray(t,e.componentType,n,e.byteOffset,e.count))}return e._data}_loadVertexBufferViewAsync(t){if(t._babylonBuffer)return t._babylonBuffer;const e=this._babylonScene.getEngine();return t._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${t.index}`,t).then(s=>new ye(e,s,!1)),t._babylonBuffer}_loadVertexAccessorAsync(t,e,s){var r;if((r=e._babylonVertexBuffer)!=null&&r[s])return e._babylonVertexBuffer[s];e._babylonVertexBuffer||(e._babylonVertexBuffer={});const n=this._babylonScene.getEngine();if(e.sparse||e.bufferView==null)e._babylonVertexBuffer[s]=this._loadFloatAccessorAsync(t,e).then(o=>new m(n,o,s,!1));else{const o=f.Get(`${t}/bufferView`,this._gltf.bufferViews,e.bufferView);e._babylonVertexBuffer[s]=this._loadVertexBufferViewAsync(o).then(i=>{const a=y._GetNumComponents(t,e.type);return new m(n,i,s,!1,void 0,o.byteStride,void 0,e.byteOffset,a,e.componentType,e.normalized,!0,void 0,!0)})}return e._babylonVertexBuffer[s]}_loadMaterialMetallicRoughnessPropertiesAsync(t,e,s){if(!(s instanceof $))throw new Error(`${t}: Material type not supported`);const n=new Array;return e&&(e.baseColorFactor?(s.albedoColor=U.FromArray(e.baseColorFactor),s.alpha=e.baseColorFactor[3]):s.albedoColor=U.White(),s.metallic=e.metallicFactor==null?1:e.metallicFactor,s.roughness=e.roughnessFactor==null?1:e.roughnessFactor,e.baseColorTexture&&n.push(this.loadTextureInfoAsync(`${t}/baseColorTexture`,e.baseColorTexture,r=>{r.name=`${s.name} (Base Color)`,s.albedoTexture=r})),e.metallicRoughnessTexture&&(e.metallicRoughnessTexture.nonColorData=!0,n.push(this.loadTextureInfoAsync(`${t}/metallicRoughnessTexture`,e.metallicRoughnessTexture,r=>{r.name=`${s.name} (Metallic Roughness)`,s.metallicTexture=r})),s.useMetallnessFromMetallicTextureBlue=!0,s.useRoughnessFromMetallicTextureGreen=!0,s.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(n).then(()=>{})}_loadMaterialAsync(t,e,s,n,r=()=>{}){const o=this._extensionsLoadMaterialAsync(t,e,s,n,r);if(o)return o;e._data=e._data||{};let i=e._data[n];if(!i){this.logOpen(`${t} ${e.name||""}`);const a=this.createMaterial(t,e,n);i={babylonMaterial:a,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(t,e,a)},e._data[n]=i,y.AddPointerMetadata(a,t),this._parent.onMaterialLoadedObservable.notifyObservers(a),this.logClose()}return s&&(i.babylonMeshes.push(s),s.onDisposeObservable.addOnce(()=>{const a=i.babylonMeshes.indexOf(s);a!==-1&&i.babylonMeshes.splice(a,1)})),r(i.babylonMaterial),i.promise.then(()=>i.babylonMaterial)}_createDefaultMaterial(t,e){this._babylonScene._blockEntityCollection=!!this._assetContainer;const s=new $(t,this._babylonScene);return s._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,s.fillMode=e,s.enableSpecularAntiAliasing=!0,s.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,s.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,s.transparencyMode=$.PBRMATERIAL_OPAQUE,s.metallic=1,s.roughness=1,s}createMaterial(t,e,s){const n=this._extensionsCreateMaterial(t,e,s);if(n)return n;const r=e.name||`material${e.index}`;return this._createDefaultMaterial(r,s)}loadMaterialPropertiesAsync(t,e,s){const n=this._extensionsLoadMaterialPropertiesAsync(t,e,s);if(n)return n;const r=new Array;return r.push(this.loadMaterialBasePropertiesAsync(t,e,s)),e.pbrMetallicRoughness&&r.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${t}/pbrMetallicRoughness`,e.pbrMetallicRoughness,s)),this.loadMaterialAlphaProperties(t,e,s),Promise.all(r).then(()=>{})}loadMaterialBasePropertiesAsync(t,e,s){if(!(s instanceof $))throw new Error(`${t}: Material type not supported`);const n=new Array;return s.emissiveColor=e.emissiveFactor?U.FromArray(e.emissiveFactor):new U(0,0,0),e.doubleSided&&(s.backFaceCulling=!1,s.twoSidedLighting=!0),e.normalTexture&&(e.normalTexture.nonColorData=!0,n.push(this.loadTextureInfoAsync(`${t}/normalTexture`,e.normalTexture,r=>{r.name=`${s.name} (Normal)`,s.bumpTexture=r})),s.invertNormalMapX=!this._babylonScene.useRightHandedSystem,s.invertNormalMapY=this._babylonScene.useRightHandedSystem,e.normalTexture.scale!=null&&s.bumpTexture&&(s.bumpTexture.level=e.normalTexture.scale),s.forceIrradianceInFragment=!0),e.occlusionTexture&&(e.occlusionTexture.nonColorData=!0,n.push(this.loadTextureInfoAsync(`${t}/occlusionTexture`,e.occlusionTexture,r=>{r.name=`${s.name} (Occlusion)`,s.ambientTexture=r})),s.useAmbientInGrayScale=!0,e.occlusionTexture.strength!=null&&(s.ambientTextureStrength=e.occlusionTexture.strength)),e.emissiveTexture&&n.push(this.loadTextureInfoAsync(`${t}/emissiveTexture`,e.emissiveTexture,r=>{r.name=`${s.name} (Emissive)`,s.emissiveTexture=r})),Promise.all(n).then(()=>{})}loadMaterialAlphaProperties(t,e,s){if(!(s instanceof $))throw new Error(`${t}: Material type not supported`);switch(e.alphaMode||"OPAQUE"){case"OPAQUE":{s.transparencyMode=$.PBRMATERIAL_OPAQUE,s.alpha=1;break}case"MASK":{s.transparencyMode=$.PBRMATERIAL_ALPHATEST,s.alphaCutOff=e.alphaCutoff==null?.5:e.alphaCutoff,s.albedoTexture&&(s.albedoTexture.hasAlpha=!0);break}case"BLEND":{s.transparencyMode=$.PBRMATERIAL_ALPHABLEND,s.albedoTexture&&(s.albedoTexture.hasAlpha=!0,s.useAlphaFromAlbedoTexture=!0);break}default:throw new Error(`${t}/alphaMode: Invalid value (${e.alphaMode})`)}}loadTextureInfoAsync(t,e,s=()=>{}){const n=this._extensionsLoadTextureInfoAsync(t,e,s);if(n)return n;if(this.logOpen(`${t}`),e.texCoord>=6)throw new Error(`${t}/texCoord: Invalid value (${e.texCoord})`);const r=f.Get(`${t}/index`,this._gltf.textures,e.index);r._textureInfo=e;const o=this._loadTextureAsync(`/textures/${e.index}`,r,i=>{i.coordinatesIndex=e.texCoord||0,y.AddPointerMetadata(i,t),this._parent.onTextureLoadedObservable.notifyObservers(i),s(i)});return this.logClose(),o}_loadTextureAsync(t,e,s=()=>{}){const n=this._extensionsLoadTextureAsync(t,e,s);if(n)return n;this.logOpen(`${t} ${e.name||""}`);const r=e.sampler==null?y.DefaultSampler:f.Get(`${t}/sampler`,this._gltf.samplers,e.sampler),o=f.Get(`${t}/source`,this._gltf.images,e.source),i=this._createTextureAsync(t,r,o,s,void 0,!e._textureInfo.nonColorData);return this.logClose(),i}_createTextureAsync(t,e,s,n=()=>{},r,o){const i=this._loadSampler(`/samplers/${e.index}`,e),a=new Array,l=new Ee;this._babylonScene._blockEntityCollection=!!this._assetContainer;const h={noMipmap:i.noMipMaps,invertY:!1,samplingMode:i.samplingMode,onLoad:()=>{this._disposed||l.resolve()},onError:(c,p)=>{this._disposed||l.reject(new Error(`${t}: ${p&&p.message?p.message:c||"Failed to load texture"}`))},mimeType:s.mimeType,loaderOptions:r,useSRGBBuffer:!!o&&this._parent.useSRGBBuffers},d=new v(null,this._babylonScene,h);return d._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,a.push(l.promise),a.push(this.loadImageAsync(`/images/${s.index}`,s).then(c=>{const p=s.uri||`${this._fileName}#image${s.index}`,_=`data:${this._uniqueRootUrl}${p}`;d.updateURL(_,c);const b=d.getInternalTexture();b&&(b.label=s.name)})),d.wrapU=i.wrapU,d.wrapV=i.wrapV,n(d),this._parent.useGltfTextureNames&&(d.name=s.name||s.uri||`image${s.index}`),Promise.all(a).then(()=>d)}_loadSampler(t,e){return e._data||(e._data={noMipMaps:e.minFilter===9728||e.minFilter===9729,samplingMode:y._GetTextureSamplingMode(t,e),wrapU:y._GetTextureWrapMode(`${t}/wrapS`,e.wrapS),wrapV:y._GetTextureWrapMode(`${t}/wrapT`,e.wrapT)}),e._data}loadImageAsync(t,e){if(!e._data){if(this.logOpen(`${t} ${e.name||""}`),e.uri)e._data=this.loadUriAsync(`${t}/uri`,e,e.uri);else{const s=f.Get(`${t}/bufferView`,this._gltf.bufferViews,e.bufferView);e._data=this.loadBufferViewAsync(`/bufferViews/${s.index}`,s)}this.logClose()}return e._data}loadUriAsync(t,e,s){const n=this._extensionsLoadUriAsync(t,e,s);if(n)return n;if(!y._ValidateUri(s))throw new Error(`${t}: '${s}' is invalid`);if(ge(s)){const r=new Uint8Array(X(s));return this.log(`${t}: Decoded ${s.substring(0,64)}... (${r.length} bytes)`),Promise.resolve(r)}return this.log(`${t}: Loading ${s}`),this._parent.preprocessUrlAsync(this._rootUrl+s).then(r=>new Promise((o,i)=>{this._parent._loadFile(this._babylonScene,r,a=>{this._disposed||(this.log(`${t}: Loaded ${s} (${a.byteLength} bytes)`),o(new Uint8Array(a)))},!0,a=>{i(new be(`${t}: Failed to load '${s}'${a?": "+a.status+" "+a.statusText:""}`,a))})}))}static AddPointerMetadata(t,e){t.metadata=t.metadata||{};const s=t._internalMetadata=t._internalMetadata||{},n=s.gltf=s.gltf||{};(n.pointers=n.pointers||[]).push(e)}static _GetTextureWrapMode(t,e){switch(e=e??10497,e){case 33071:return v.CLAMP_ADDRESSMODE;case 33648:return v.MIRROR_ADDRESSMODE;case 10497:return v.WRAP_ADDRESSMODE;default:return E.Warn(`${t}: Invalid value (${e})`),v.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(t,e){const s=e.magFilter==null?9729:e.magFilter,n=e.minFilter==null?9987:e.minFilter;if(s===9729)switch(n){case 9728:return v.LINEAR_NEAREST;case 9729:return v.LINEAR_LINEAR;case 9984:return v.LINEAR_NEAREST_MIPNEAREST;case 9985:return v.LINEAR_LINEAR_MIPNEAREST;case 9986:return v.LINEAR_NEAREST_MIPLINEAR;case 9987:return v.LINEAR_LINEAR_MIPLINEAR;default:return E.Warn(`${t}/minFilter: Invalid value (${n})`),v.LINEAR_LINEAR_MIPLINEAR}else switch(s!==9728&&E.Warn(`${t}/magFilter: Invalid value (${s})`),n){case 9728:return v.NEAREST_NEAREST;case 9729:return v.NEAREST_LINEAR;case 9984:return v.NEAREST_NEAREST_MIPNEAREST;case 9985:return v.NEAREST_LINEAR_MIPNEAREST;case 9986:return v.NEAREST_NEAREST_MIPLINEAR;case 9987:return v.NEAREST_LINEAR_MIPLINEAR;default:return E.Warn(`${t}/minFilter: Invalid value (${n})`),v.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(t,e){try{return Ae(e)}catch(s){throw new Error(`${t}: ${s.message}`)}}static _GetTypedArray(t,e,s,n,r){const o=s.buffer;n=s.byteOffset+(n||0);const i=y._GetTypedArrayConstructor(`${t}/componentType`,e),a=m.GetTypeByteLength(e);return n%a!==0?(E.Warn(`${t}: Copying buffer as byte offset (${n}) is not a multiple of component type byte length (${a})`),new i(o.slice(n,n+r*a),0)):new i(o,n,r)}static _GetNumComponents(t,e){switch(e){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":return 4;case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${t}: Invalid type (${e})`)}static _ValidateUri(t){return P.IsBase64(t)||t.indexOf("..")===-1}static _GetDrawMode(t,e){switch(e==null&&(e=4),e){case 0:return S.PointListDrawMode;case 1:return S.LineListDrawMode;case 2:return S.LineLoopDrawMode;case 3:return S.LineStripDrawMode;case 4:return S.TriangleFillMode;case 5:return S.TriangleStripDrawMode;case 6:return S.TriangleFanDrawMode}throw new Error(`${t}: Invalid mesh primitive mode (${e})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const t=new Array;if(this._gltf.materials){for(const e of this._gltf.materials)if(e._data)for(const s in e._data){const n=e._data[s];for(const r of n.babylonMeshes){r.computeWorldMatrix(!0);const o=n.babylonMaterial;t.push(o.forceCompilationAsync(r)),t.push(o.forceCompilationAsync(r,{useInstances:!0})),this._parent.useClipPlane&&(t.push(o.forceCompilationAsync(r,{clipPlane:!0})),t.push(o.forceCompilationAsync(r,{clipPlane:!0,useInstances:!0})))}}}return Promise.all(t).then(()=>{this._parent._endPerformanceCounter("Compile materials")})}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const t=new Array,e=this._babylonScene.lights;for(const s of e){const n=s.getShadowGenerator();n&&t.push(n.forceCompilationAsync())}return Promise.all(t).then(()=>{this._parent._endPerformanceCounter("Compile shadow generators")})}_forEachExtensions(t){for(const e of this._extensions)e.enabled&&t(e)}_applyExtensions(t,e,s){for(const n of this._extensions)if(n.enabled){const r=`${n.name}.${e}`,o=t;o._activeLoaderExtensionFunctions=o._activeLoaderExtensionFunctions||{};const i=o._activeLoaderExtensionFunctions;if(!i[r]){i[r]=!0;try{const a=s(n);if(a)return a}finally{delete i[r]}}}return null}_extensionsOnLoading(){this._forEachExtensions(t=>t.onLoading&&t.onLoading())}_extensionsOnReady(){this._forEachExtensions(t=>t.onReady&&t.onReady())}_extensionsLoadSceneAsync(t,e){return this._applyExtensions(e,"loadScene",s=>s.loadSceneAsync&&s.loadSceneAsync(t,e))}_extensionsLoadNodeAsync(t,e,s){return this._applyExtensions(e,"loadNode",n=>n.loadNodeAsync&&n.loadNodeAsync(t,e,s))}_extensionsLoadCameraAsync(t,e,s){return this._applyExtensions(e,"loadCamera",n=>n.loadCameraAsync&&n.loadCameraAsync(t,e,s))}_extensionsLoadVertexDataAsync(t,e,s){return this._applyExtensions(e,"loadVertexData",n=>n._loadVertexDataAsync&&n._loadVertexDataAsync(t,e,s))}_extensionsLoadMeshPrimitiveAsync(t,e,s,n,r,o){return this._applyExtensions(r,"loadMeshPrimitive",i=>i._loadMeshPrimitiveAsync&&i._loadMeshPrimitiveAsync(t,e,s,n,r,o))}_extensionsLoadMaterialAsync(t,e,s,n,r){return this._applyExtensions(e,"loadMaterial",o=>o._loadMaterialAsync&&o._loadMaterialAsync(t,e,s,n,r))}_extensionsCreateMaterial(t,e,s){return this._applyExtensions(e,"createMaterial",n=>n.createMaterial&&n.createMaterial(t,e,s))}_extensionsLoadMaterialPropertiesAsync(t,e,s){return this._applyExtensions(e,"loadMaterialProperties",n=>n.loadMaterialPropertiesAsync&&n.loadMaterialPropertiesAsync(t,e,s))}_extensionsLoadTextureInfoAsync(t,e,s){return this._applyExtensions(e,"loadTextureInfo",n=>n.loadTextureInfoAsync&&n.loadTextureInfoAsync(t,e,s))}_extensionsLoadTextureAsync(t,e,s){return this._applyExtensions(e,"loadTexture",n=>n._loadTextureAsync&&n._loadTextureAsync(t,e,s))}_extensionsLoadAnimationAsync(t,e){return this._applyExtensions(e,"loadAnimation",s=>s.loadAnimationAsync&&s.loadAnimationAsync(t,e))}_extensionsLoadAnimationChannelAsync(t,e,s,n,r){return this._applyExtensions(s,"loadAnimationChannel",o=>o._loadAnimationChannelAsync&&o._loadAnimationChannelAsync(t,e,s,n,r))}_extensionsLoadSkinAsync(t,e,s){return this._applyExtensions(s,"loadSkin",n=>n._loadSkinAsync&&n._loadSkinAsync(t,e,s))}_extensionsLoadUriAsync(t,e,s){return this._applyExtensions(e,"loadUri",n=>n._loadUriAsync&&n._loadUriAsync(t,e,s))}_extensionsLoadBufferViewAsync(t,e){return this._applyExtensions(e,"loadBufferView",s=>s.loadBufferViewAsync&&s.loadBufferViewAsync(t,e))}_extensionsLoadBufferAsync(t,e,s,n){return this._applyExtensions(e,"loadBuffer",r=>r.loadBufferAsync&&r.loadBufferAsync(t,e,s,n))}static LoadExtensionAsync(t,e,s,n){if(!e.extensions)return null;const o=e.extensions[s];return o?n(`${t}/extensions/${s}`,o):null}static LoadExtraAsync(t,e,s,n){if(!e.extras)return null;const o=e.extras[s];return o?n(`${t}/extras/${s}`,o):null}isExtensionUsed(t){return!!this._gltf.extensionsUsed&&this._gltf.extensionsUsed.indexOf(t)!==-1}logOpen(t){this._parent._logOpen(t)}logClose(){this._parent._logClose()}log(t){this._parent._log(t)}startPerformanceCounter(t){this._parent._startPerformanceCounter(t)}endPerformanceCounter(t){this._parent._endPerformanceCounter(t)}}y.DefaultSampler={index:-1};O._CreateGLTF2Loader=u=>new y(u);const Se=Object.freeze(Object.defineProperty({__proto__:null,ArrayItem:f,GLTFFileLoader:O,GLTFLoader:y,LoadBoundingInfoFromPositionAccessor:Q},Symbol.toStringTag,{value:"Module"}));export{f as A,Ee as D,y as G,Q as L,Se as g};
